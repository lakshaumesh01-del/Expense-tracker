<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expense Tracker Pro</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Track your expenses, set budgets, and manage your finances with Expense Tracker Pro">
    <meta name="theme-color" content="#1e3c72">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Expense Tracker">
    
    <!-- Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'><rect width='180' height='180' fill='%231e3c72' rx='40'/><text x='90' y='130' font-size='110' text-anchor='middle' fill='%23ffd89b'>üí∞</text></svg>">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-image: 
                url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 600"><circle cx="100" cy="100" r="50" fill="rgba(255,255,255,0.05)"/><circle cx="900" cy="400" r="80" fill="rgba(255,255,255,0.05)"/><circle cx="1100" cy="150" r="60" fill="rgba(255,255,255,0.05)"/><circle cx="200" cy="500" r="70" fill="rgba(255,255,255,0.05)"/><path d="M 50,300 Q 200,200 350,300 T 650,300" stroke="rgba(255,255,255,0.03)" stroke-width="2" fill="none"/></svg>'),
                linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-size: cover;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #1e3c72 100%);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
        }

        h1 {
            color: #ffffff;
            margin-bottom: 30px;
            text-align: center;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }

        .stat-card h3 {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .stat-card .amount {
            font-size: 2em;
            font-weight: bold;
        }

        .budget-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .form-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            margin-bottom: 5px;
            font-weight: 600;
            color: #ffffff;
        }

        input, select {
            padding: 12px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 8px;
            font-size: 1em;
            transition: border 0.3s;
            background: rgba(255,255,255,0.9);
            color: #333;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #ffd89b;
            background: #ffffff;
        }

        button {
            background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(255, 216, 155, 0.3);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 216, 155, 0.5);
        }

        .filter-section {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .expenses-section {
            margin-bottom: 30px;
        }

        .expense-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .expense-item {
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }

        .expense-item:hover {
            border-color: #ffd89b;
            box-shadow: 0 5px 15px rgba(255, 216, 155, 0.4);
            transform: translateY(-2px);
        }

        .expense-details {
            flex: 1;
        }

        .expense-title {
            font-weight: 600;
            font-size: 1.1em;
            color: #333;
            margin-bottom: 5px;
        }

        .expense-meta {
            color: #666;
            font-size: 0.9em;
        }

        .expense-amount {
            font-size: 1.3em;
            font-weight: bold;
            color: #f5576c;
            margin-right: 15px;
        }

        .delete-btn {
            background: #f5576c;
            padding: 8px 15px;
            font-size: 0.9em;
        }

        .delete-btn:hover {
            background: #e04858;
        }

        .category-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            margin-right: 10px;
        }

        .chart-container {
            margin-top: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        canvas {
            max-height: 300px;
        }

        .no-expenses {
            text-align: center;
            padding: 40px;
            color: rgba(255,255,255,0.7);
            font-size: 1.1em;
        }

        .logo-container {
            text-align: center;
            margin-bottom: 20px;
        }

        .logo {
            width: 80px;
            height: 80px;
            margin: 0 auto 10px;
            background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .empty-state-illustration {
            width: 200px;
            height: 200px;
            margin: 0 auto 20px;
            opacity: 0.3;
        }

        .illustration-container {
            text-align: center;
        }

        .install-prompt {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);
            color: white;
            padding: 15px 30px;
            border-radius: 50px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.4);
            display: none;
            z-index: 1000;
            animation: slideUp 0.5s ease;
        }

        .install-prompt.show {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        @keyframes slideUp {
            from {
                bottom: -100px;
                opacity: 0;
            }
            to {
                bottom: 20px;
                opacity: 1;
            }
        }

        .install-btn {
            background: white;
            color: #19547b;
            padding: 8px 20px;
            border-radius: 25px;
            border: none;
            font-weight: bold;
            cursor: pointer;
        }

        .close-install {
            cursor: pointer;
            font-size: 1.2em;
        }

        .alert {
            background: #fff3cd;
            border: 2px solid #ffc107;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .alert.show {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo-container">
            <div class="logo">üí∞</div>
            <button onclick="enableNotifications()" id="notifBtn" style="font-size: 0.9em; padding: 8px 20px; margin-top: 10px;">
                üîî Enable Notifications
            </button>
        </div>
        <h1>üí∞ Expense Tracker Pro</h1>

        <div id="budgetAlert" class="alert"></div>

        <div class="dashboard">
            <div class="stat-card">
                <div style="font-size: 30px; margin-bottom: 5px;">üìä</div>
                <h3>Total Expenses</h3>
                <div class="amount" id="totalExpenses">‚Çπ0.00</div>
            </div>
            <div class="stat-card budget-card">
                <div style="font-size: 30px; margin-bottom: 5px;">üéØ</div>
                <h3>Monthly Budget</h3>
                <div class="amount" id="budgetDisplay">‚Çπ0.00</div>
            </div>
            <div class="stat-card">
                <div style="font-size: 30px; margin-bottom: 5px;">üíµ</div>
                <h3>Remaining</h3>
                <div class="amount" id="remaining">‚Çπ0.00</div>
            </div>
            <div class="stat-card">
                <div style="font-size: 30px; margin-bottom: 5px;">üìà</div>
                <h3>Expense Count</h3>
                <div class="amount" id="expenseCount">0</div>
            </div>
        </div>

        <div class="form-section">
            <h2 style="margin-bottom: 20px; color: #ffffff;">Set Monthly Budget</h2>
            <div style="display: flex; gap: 10px;">
                <input type="number" id="budgetInput" placeholder="Enter monthly budget" min="0" step="0.01">
                <button onclick="setBudget()">Set Budget</button>
            </div>
        </div>

        <div class="form-section">
            <h2 style="margin-bottom: 20px; color: #ffffff;">Add New Expense</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label>Description</label>
                    <input type="text" id="description" placeholder="e.g., Grocery shopping">
                </div>
                <div class="form-group">
                    <label>Amount (‚Çπ)</label>
                    <input type="number" id="amount" placeholder="0.00" min="0" step="0.01">
                </div>
                <div class="form-group">
                    <label>Category</label>
                    <select id="category">
                        <option value="Food">üçî Food</option>
                        <option value="Transportation">üöó Transportation</option>
                        <option value="Entertainment">üé¨ Entertainment</option>
                        <option value="Shopping">üõçÔ∏è Shopping</option>
                        <option value="Bills">üí° Bills</option>
                        <option value="Healthcare">üè• Healthcare</option>
                        <option value="Education">üìö Education</option>
                        <option value="Other">üì¶ Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Date</label>
                    <input type="date" id="date">
                </div>
            </div>
            <button onclick="addExpense()">Add Expense</button>
        </div>

        <div class="expenses-section">
            <h2 style="margin-bottom: 20px; color: #ffffff;">Filter Expenses</h2>
            <div class="filter-section">
                <select id="filterCategory" onchange="filterExpenses()">
                    <option value="all">All Categories</option>
                    <option value="Food">üçî Food</option>
                    <option value="Transportation">üöó Transportation</option>
                    <option value="Entertainment">üé¨ Entertainment</option>
                    <option value="Shopping">üõçÔ∏è Shopping</option>
                    <option value="Bills">üí° Bills</option>
                    <option value="Healthcare">üè• Healthcare</option>
                    <option value="Education">üìö Education</option>
                    <option value="Other">üì¶ Other</option>
                </select>
                <input type="date" id="filterStartDate" onchange="filterExpenses()" placeholder="Start Date">
                <input type="date" id="filterEndDate" onchange="filterExpenses()" placeholder="End Date">
                <button onclick="clearFilters()">Clear Filters</button>
            </div>

            <h2 style="margin-bottom: 20px; color: #ffffff;">Your Expenses</h2>
            <div class="expense-list" id="expenseList">
                <div class="no-expenses">No expenses yet. Add your first expense above!</div>
            </div>
        </div>

        <div class="chart-container">
            <h2 style="margin-bottom: 20px; color: #ffffff;">Expenses by Category</h2>
            <canvas id="categoryChart"></canvas>
        </div>
    </div>

    <!-- Install Prompt -->
    <div class="install-prompt" id="installPrompt">
        <span>üì± Install Expense Tracker as an app!</span>
        <button class="install-btn" id="installBtn">Install</button>
        <span class="close-install" id="closeInstall">‚úï</span>
    </div>

    <script>
        // PWA Install Prompt
        let deferredPrompt;
        
        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(registration => {
                        console.log('ServiceWorker registered:', registration);
                    })
                    .catch(err => {
                        console.log('ServiceWorker registration failed:', err);
                    });
            });
        }

        // Handle install prompt
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Show install prompt after 3 seconds
            setTimeout(() => {
                document.getElementById('installPrompt').classList.add('show');
            }, 3000);
        });

        document.getElementById('installBtn').addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                console.log(`User response: ${outcome}`);
                deferredPrompt = null;
                document.getElementById('installPrompt').classList.remove('show');
            }
        });

        document.getElementById('closeInstall').addEventListener('click', () => {
            document.getElementById('installPrompt').classList.remove('show');
        });

        // Detect if app is installed
        window.addEventListener('appinstalled', () => {
            console.log('App installed successfully!');
            document.getElementById('installPrompt').classList.remove('show');
        });

        let expenses = JSON.parse(localStorage.getItem('expenses')) || [];
        let budget = parseFloat(localStorage.getItem('budget')) || 0;
        let notificationsEnabled = false;

        // Request notification permission on page load
        if ('Notification' in window) {
            if (Notification.permission === 'granted') {
                notificationsEnabled = true;
                updateNotificationButton();
            } else if (Notification.permission !== 'denied') {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        notificationsEnabled = true;
                        updateNotificationButton();
                        showNotification('Notifications Enabled! üîî', 'You will receive alerts for low balance and budget warnings.');
                    }
                });
            }
        }

        function enableNotifications() {
            if ('Notification' in window) {
                if (Notification.permission === 'granted') {
                    showNotification('Notifications Already Enabled! ‚úÖ', 'You are receiving all alerts.');
                } else if (Notification.permission === 'denied') {
                    alert('Notifications are blocked. Please enable them in your browser settings.');
                } else {
                    Notification.requestPermission().then(permission => {
                        if (permission === 'granted') {
                            notificationsEnabled = true;
                            updateNotificationButton();
                            showNotification('Notifications Enabled! üîî', 'You will now receive budget alerts and warnings.');
                        } else {
                            alert('Notification permission denied. You can enable it later from browser settings.');
                        }
                    });
                }
            } else {
                alert('Your browser does not support notifications.');
            }
        }

        function updateNotificationButton() {
            const btn = document.getElementById('notifBtn');
            if (Notification.permission === 'granted') {
                btn.textContent = '‚úÖ Notifications Enabled';
                btn.style.background = 'linear-gradient(135deg, #4caf50 0%, #2e7d32 100%)';
            } else {
                btn.textContent = 'üîî Enable Notifications';
            }
        }

        function showNotification(title, body, icon = 'üí∞') {
            if (notificationsEnabled && Notification.permission === 'granted') {
                const notification = new Notification(title, {
                    body: body,
                    icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y="75" font-size="75">üí∞</text></svg>',
                    badge: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y="75" font-size="75">üí∞</text></svg>',
                    requireInteraction: true,
                    tag: 'expense-tracker-alert'
                });

                // Auto close after 10 seconds
                setTimeout(() => notification.close(), 10000);
            }
        }

        const categoryColors = {
            'Food': '#FF6384',
            'Transportation': '#36A2EB',
            'Entertainment': '#FFCE56',
            'Shopping': '#4BC0C0',
            'Bills': '#9966FF',
            'Healthcare': '#FF9F40',
            'Education': '#FF6384',
            'Other': '#C9CBCF'
        };

        // Set today's date as default
        document.getElementById('date').valueAsDate = new Date();

        function setBudget() {
            const budgetValue = parseFloat(document.getElementById('budgetInput').value);
            if (budgetValue && budgetValue > 0) {
                budget = budgetValue;
                localStorage.setItem('budget', budget);
                
                // Send notification
                showNotification(
                    'üéØ Budget Set',
                    `Your monthly budget is now ‚Çπ${budget.toFixed(2)}`
                );
                
                updateDashboard();
                checkBudgetAlert();
                document.getElementById('budgetInput').value = '';
            }
        }

        function addExpense() {
            const description = document.getElementById('description').value;
            const amount = parseFloat(document.getElementById('amount').value);
            const category = document.getElementById('category').value;
            const date = document.getElementById('date').value;

            if (!description || !amount || !date) {
                alert('Please fill in all fields!');
                return;
            }

            const expense = {
                id: Date.now(),
                description,
                amount,
                category,
                date
            };

            expenses.push(expense);
            localStorage.setItem('expenses', JSON.stringify(expenses));

            // Send notification for expense added
            const total = expenses.reduce((sum, exp) => sum + exp.amount, 0);
            const remaining = budget - total;
            
            showNotification(
                '‚úÖ Expense Added',
                `‚Çπ${amount.toFixed(2)} - ${description}. Remaining budget: ‚Çπ${remaining.toFixed(2)}`
            );

            // Clear form
            document.getElementById('description').value = '';
            document.getElementById('amount').value = '';
            document.getElementById('date').valueAsDate = new Date();

            updateDashboard();
            filterExpenses();
            updateChart();
            checkBudgetAlert();
        }

        function deleteExpense(id) {
            expenses = expenses.filter(exp => exp.id !== id);
            localStorage.setItem('expenses', JSON.stringify(expenses));
            updateDashboard();
            filterExpenses();
            updateChart();
            checkBudgetAlert();
        }

        function filterExpenses() {
            const categoryFilter = document.getElementById('filterCategory').value;
            const startDate = document.getElementById('filterStartDate').value;
            const endDate = document.getElementById('filterEndDate').value;

            let filtered = expenses;

            if (categoryFilter !== 'all') {
                filtered = filtered.filter(exp => exp.category === categoryFilter);
            }

            if (startDate) {
                filtered = filtered.filter(exp => exp.date >= startDate);
            }

            if (endDate) {
                filtered = filtered.filter(exp => exp.date <= endDate);
            }

            displayExpenses(filtered);
        }

        function clearFilters() {
            document.getElementById('filterCategory').value = 'all';
            document.getElementById('filterStartDate').value = '';
            document.getElementById('filterEndDate').value = '';
            filterExpenses();
        }

        function displayExpenses(expensesToShow) {
            const expenseList = document.getElementById('expenseList');

            if (expensesToShow.length === 0) {
                expenseList.innerHTML = `
                    <div class="illustration-container">
                        <svg class="empty-state-illustration" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="100" cy="100" r="80" fill="#f0f0f0"/>
                            <path d="M 60,100 L 100,60 L 140,100 L 100,140 Z" fill="#667eea" opacity="0.5"/>
                            <circle cx="100" cy="100" r="30" fill="#764ba2" opacity="0.7"/>
                            <text x="100" y="110" text-anchor="middle" font-size="40" fill="white">‚Çπ</text>
                        </svg>
                        <div class="no-expenses">No expenses found.</div>
                    </div>
                `;
                return;
            }

            // Sort by date (newest first)
            expensesToShow.sort((a, b) => new Date(b.date) - new Date(a.date));

            expenseList.innerHTML = expensesToShow.map(exp => `
                <div class="expense-item">
                    <div class="expense-details">
                        <div class="expense-title">${exp.description}</div>
                        <div class="expense-meta">
                            <span class="category-badge" style="background: ${categoryColors[exp.category]}20; color: ${categoryColors[exp.category]};">
                                ${exp.category}
                            </span>
                            ${new Date(exp.date).toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' })}
                        </div>
                    </div>
                    <div style="display: flex; align-items: center;">
                        <div class="expense-amount">‚Çπ${exp.amount.toFixed(2)}</div>
                        <button class="delete-btn" onclick="deleteExpense(${exp.id})">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function updateDashboard() {
            const total = expenses.reduce((sum, exp) => sum + exp.amount, 0);
            const remaining = budget - total;

            document.getElementById('totalExpenses').textContent = `‚Çπ${total.toFixed(2)}`;
            document.getElementById('budgetDisplay').textContent = `‚Çπ${budget.toFixed(2)}`;
            document.getElementById('remaining').textContent = `‚Çπ${remaining.toFixed(2)}`;
            document.getElementById('expenseCount').textContent = expenses.length;

            // Color code remaining amount
            const remainingElement = document.getElementById('remaining');
            if (remaining < 0) {
                remainingElement.style.color = '#f5576c';
            } else if (remaining < budget * 0.2) {
                remainingElement.style.color = '#ffc107';
            } else {
                remainingElement.style.color = '#4caf50';
            }
        }

        function checkBudgetAlert() {
            const total = expenses.reduce((sum, exp) => sum + exp.amount, 0);
            const remaining = budget - total;
            const alertDiv = document.getElementById('budgetAlert');

            if (budget > 0) {
                const percentage = (total / budget) * 100;

                if (total > budget) {
                    const overAmount = (total - budget).toFixed(2);
                    alertDiv.textContent = `‚ö†Ô∏è Budget Exceeded! You've spent ‚Çπ${overAmount} over your budget.`;
                    alertDiv.className = 'alert show';
                    alertDiv.style.background = '#f8d7da';
                    alertDiv.style.borderColor = '#f5c6cb';
                    alertDiv.style.color = '#721c24';
                    
                    // Send notification
                    showNotification(
                        'üö® Budget Exceeded!',
                        `You've spent ‚Çπ${overAmount} over your monthly budget of ‚Çπ${budget.toFixed(2)}.`
                    );
                } else if (remaining < 10000 && remaining > 0) {
                    alertDiv.textContent = `‚ö†Ô∏è Low Balance Alert! Only ‚Çπ${remaining.toFixed(2)} remaining in your budget.`;
                    alertDiv.className = 'alert show';
                    alertDiv.style.background = '#fff3cd';
                    alertDiv.style.borderColor = '#ffc107';
                    alertDiv.style.color = '#856404';
                    
                    // Send notification for low balance
                    showNotification(
                        '‚ö†Ô∏è Low Balance Alert!',
                        `Only ‚Çπ${remaining.toFixed(2)} remaining in your budget. Please spend carefully!`
                    );
                } else if (percentage >= 80) {
                    alertDiv.textContent = `‚ö†Ô∏è Warning! You've used ${percentage.toFixed(0)}% of your monthly budget.`;
                    alertDiv.className = 'alert show';
                    alertDiv.style.background = '#fff3cd';
                    alertDiv.style.borderColor = '#ffc107';
                    alertDiv.style.color = '#856404';
                    
                    // Send notification for 80% threshold
                    showNotification(
                        '‚ö†Ô∏è Budget Warning!',
                        `You've used ${percentage.toFixed(0)}% of your monthly budget. ‚Çπ${remaining.toFixed(2)} remaining.`
                    );
                } else {
                    alertDiv.className = 'alert';
                }
            }
        }

        function updateChart() {
            const categoryTotals = {};

            expenses.forEach(exp => {
                categoryTotals[exp.category] = (categoryTotals[exp.category] || 0) + exp.amount;
            });

            const labels = Object.keys(categoryTotals);
            const data = Object.values(categoryTotals);
            const colors = labels.map(cat => categoryColors[cat]);

            const ctx = document.getElementById('categoryChart').getContext('2d');

            if (window.myChart) {
                window.myChart.destroy();
            }

            window.myChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors,
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 15,
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `${label}: ‚Çπ${value.toFixed(2)} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // Initialize
        updateDashboard();
        filterExpenses();
        updateChart();
        checkBudgetAlert();
        updateNotificationButton();
        if (budget > 0) {
            document.getElementById('budgetInput').value = budget;
        }
    </script>
</body>
</html>
